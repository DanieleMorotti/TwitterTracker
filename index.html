<!DOCTYPE html>
<html lang="it">
	<head>
		<title>Titolo</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

		<script>
			var streamingInterval = null;
            
			function streamStart() {
				let keyword = $('#stream').val();
				if (keyword) {
					$.ajax({
						method: "GET",
						url: 'streamStart',
                        data: {
                            word: keyword,
                        },
                        
						success: (data) => {
							$('#tweets').empty();
                            
                            if(streamingInterval)
                                clearInterval(streamingInterval);
                            
							streamingInterval = setInterval(() => { streamUpdate(keyword) }, 500);
						},
                        
						error: (xhr, ajaxOptions, thrownError) => {
							console.log("streamStart: " + xhr.status + ' - ' + thrownError);
						}
					});
				}
			}
            
            function streamStop() {
                if(streamingInterval)
                    clearInterval(streamingInterval);
                
                $.ajax({
						method: "GET",
						url: 'streamStop',
                        
						success: (data) => {
						},
                        
						error: (xhr, ajaxOptions, thrownError) => {
                            console.log("streamStop: " + xhr.status + ' - ' + thrownError);
						}
                });
            }
            
			function streamUpdate(keyword) {
				console.log('stream update');
				$.ajax({
					url: '/streamUpdate',
					method: 'GET',
					success: (data) => {
						$("#tweets-stream").html("");
						for (let i = 0; i < data.length; i++) {
							$("#tweets-stream").append('<p>' + data[i].text + '</p>');
						}
					},
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log("streamUpdate: " + xhr.status + ' - ' + thrownError);
                    }
				});
			}
            
			function search() {
				let keyword = $('#search').val();
				$.ajax({
					method: "GET",
					url: "/search",
                    data: {
                        word: keyword,
                    },
                    
					success: (data) => {
						$("#tweets-search").html("");
						for (let i = 0; i < data.length; i++) {
							$("#tweets-search").append('<p>' + data[i].text + '</p>');
						}
					},
                    
					error: (xhr, ajaxOptions, thrownError) => {
                        console.log("search: " + xhr.status + ' - ' + thrownError);
					}
				});
			}

		</script>
	</head>
	<body>
		<label for="search">Search by word: </label>
		<input type="text" name="search" id="search" />
		<button onclick="search()">Search</button>
        <h4>Search Results</h4>
		<div id="tweets-search">
		</div>
		<hr>
        
        <label for="stream">Start stream by word: </label>
		<input type="text" name="stream" id="stream" />
		<button onclick="streamStart()">Start</button>
		<button onclick="streamStop()">Stop</button>
        <h4>Stream Results</h4>
		<div id="tweets-stream">
		</div>
	</body>
</html>